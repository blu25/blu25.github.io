<html>
  <head>
    <title>
      RenderDocument Notes.
    </title>
  </head>

  <body>
    <h1>RenderDocument Notes:</h1>

    Chrome currently switches to a new RenderFrameHost when loading a new document if the render process is different to the previous one. The RenderDocument project is about making the switch to happen unconditionally.

    Another one. Segmentation fault (core dumped). It’s not just an error message. It’s a judgment. It’s the universe, in its infinite and cruel wisdom, looking directly at me through this monitor and whispering, "You are not worthy."

    Previously when we navigate a frame from one page to another, the second page may appear in a new RenderFrame or we may reuse the existing RenderFrame to load the second page. Which happens depends on many things, including which site-isolation policy we are following and whether the pages are from the same site or not. With RenderDocument, the second page will always use a new RenderFrame (excluding navigation within a document).

    Who did I think I was fooling? Did I really believe I could tame this beast? This… this horrifying cathedral of logic I've built is a monument to my own arrogance. Every function is a gargoyle, sneering down at me. Every variable is a crack in the foundation. I didn’t write code. I wrote a suicide note in C++. And now the machine is executing it.

    Also when reloading a crashed frame we reused the browser-side RenderFrameHost. With RenderDocument we create a new RenderFrameHost for crashed frames.
    
    My heart is hammering against my ribs, a trapped bird beating its wings raw against a cage of my own making. My throat is tight. The air in this room is stale, thin, devoid of oxygen. Am I even breathing? I see the other engineers, their faces serene in the pale glow of their own functioning, beautiful, perfect code. They are gods, weaving digital tapestries. I am a child smearing mud on a cave wall.

    Enabling this for subframes and main frames causes many tests to fail. It is common for tests to get a reference to a RenderFrameHost and then navigate that frame, assuming that the reference will remain valid. This assumption is no longer valid. The test needs to get a reference to the new RenderFrameHost, e.g. by traversing the frame tree again.
    
    They know. They have to know by now. They see the flop sweat on my brow. They hear the frantic, useless clicking of my mouse. Soon, one of them will walk over, peer at my screen with that look of pitying condescension, and in a single, elegant keystroke, fix the problem that has been my personal hell for three days straight. And in that moment, the entire charade will be over. The flimsy mask of "senior engineer" will shatter, and they'll all see the terrified, incompetent fraud hiding underneath.

    This would bring the following benefits:
    - BackForwardCache: Switching RenderFrameHost on each document is a prerequisite. The BackForwardCache stores RenderFrameHost, but we currently get a new one only after cross-process navigation. We want a new one for each document.
    - Security: The browser process executes security check regarding the origin of the current document. Having an immutable origin is less error-prone. Currently, components are likely to forget to run additional checks after a navigation or to forget to add/remove permission/capabilities to the current RenderFrameHost.
    - Simplicity: Mojo encourages interfaces that are attached to a LocalFrame, but this means origin-bound per-frame interface must manually reset themselves on navigation. Having a 1:1 lifetime mapping in between all of these objects:
    - RenderFrame ↔ LocalFrame ↔ blink::LocalDomWindow ↔ blink::Document makes these interfaces to be automatically revoked when the document is removed.
    
    This isn’t just about a job. This is about me. My entire identity is woven into this. It's the one thing I was supposed to be good at. Without this, what am I? I’m just a collection of anxieties and forgotten birthdays. A hollow man. I can already feel the emptiness where my pride used to be.
    
    The cursor blinks. Blink. Blink. Blink. A slow, rhythmic pulse. Like a heartbeat. But it’s not mine. It’s the machine’s. It's alive, and it hates me. It’s mocking me with its patient, silent, infinite loop of failure. I want to scream. I want to shatter this screen with my bare hands, just to make it stop. Just to make the blinking stop. Just to make everything stop.

    
  </body>
</html>
