<html manifest="mf.appcache">
	<head>
		<title>Crolard Tracker</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon.png">
		<script>

var inbound = false;
var shouldAnimate = true;
var updateInterval;

function changeDir() {
  clearInterval(updateInterval);
  inbound = !inbound;
  if (inbound)
    document.getElementById("bound").innerText = "Talloires > Annecy";
  else
    document.getElementById("bound").innerText = "Annecy > Talloires";

  shouldAnimate = true;
  update();
}

data = {
  "stops": [
    {
      "name": "Annecy Gare routi&egrave;re",
      "outbound": [
        [],
        [375, 465, 675, 750, 855, 1030, 1090, 1150],
        [375, 465, 675, 750, 855, 1030, 1090, 1150],
        [375, 465, 675, 750, 855, 1030, 1090, 1150],
        [375, 465, 675, 750, 855, 1030, 1090, 1150],
        [375, 465, 675, 750, 855, 1030, 1090, 1150],
        [375, 465,      750, 855,       1090      ],
      ],
      "inbound": [
        [],
        [440, 525, 740, 825, 925, 1100, 1160, 1205],
        [440, 525, 740, 825, 925, 1100, 1160, 1205],
        [440, 525, 740, 825, 925, 1100, 1160, 1205],
        [440, 525, 740, 825, 925, 1100, 1160, 1205],
        [440, 525, 740, 825, 925, 1100, 1160, 1205],
        [440, 525,      825, 925,       1160,     ],
      ]
    },

    {
      "name": "Palais de Justice",
      "outbound": [
        [],
        [378, 468, 678, 753, 858, 1033, 1093, 1153],
        [378, 468, 678, 753, 858, 1033, 1093, 1153],
        [378, 468, 678, 753, 858, 1033, 1093, 1153],
        [378, 468, 678, 753, 858, 1033, 1093, 1153],
        [378, 468, 678, 753, 858, 1033, 1093, 1153],
        [378, 468,      753, 858,       1093,     ],
      ],
      "inbound": [
        [],
        [437, 522, 737, 822, 920, 1095, 1155, 1203],
        [437, 522, 737, 822, 920, 1095, 1155, 1203],
        [437, 522, 737, 822, 920, 1095, 1155, 1203],
        [437, 522, 737, 822, 920, 1095, 1155, 1203],
        [437, 522, 737, 822, 920, 1095, 1155, 1203],
        [437, 522,      822, 920,       1155,     ],
      ]
    },

    {
      "name": "Annecy-le-Vieux Albigny",
      "outbound": [
        [],
        [379, 469, 679, 754, 859, 1034, 1094, 1154],
        [379, 469, 679, 754, 859, 1034, 1094, 1154],
        [379, 469, 679, 754, 859, 1034, 1094, 1154],
        [379, 469, 679, 754, 859, 1034, 1094, 1154],
        [379, 469, 679, 754, 859, 1034, 1094, 1154],
        [379, 469,      754, 859,       1094,     ],
      ],
      "inbound": [
        [],
        [435, 520, 734, 819, 915, 1092, 1152, 1201],
        [435, 520, 734, 819, 915, 1092, 1152, 1201],
        [435, 520, 734, 819, 915, 1092, 1152, 1201],
        [435, 520, 734, 819, 915, 1092, 1152, 1201],
        [435, 520, 734, 819, 915, 1092, 1152, 1201],
        [435, 520,      819, 915,       1152,     ],
      ]
    },

    {
      "name": "Annecy-le-Vieux Pr&eacute; Vernet",
      "outbound": [
        [],
        [382, 472, 682, 757, 862, 1037, 1097, 1157],
        [382, 472, 682, 757, 862, 1037, 1097, 1157],
        [382, 472, 682, 757, 862, 1037, 1097, 1157],
        [382, 472, 682, 757, 862, 1037, 1097, 1157],
        [382, 472, 682, 757, 862, 1037, 1097, 1157],
        [382, 472,      757, 862,       1097,     ],
      ],
      "inbound": [
        [],
        [430, 515, 730, 815, 910, 1088, 1148, 1200],
        [430, 515, 730, 815, 910, 1088, 1148, 1200],
        [430, 515, 730, 815, 910, 1088, 1148, 1200],
        [430, 515, 730, 815, 910, 1088, 1148, 1200],
        [430, 515, 730, 815, 910, 1088, 1148, 1200],
        [430, 515,      815, 910,       1148,     ],
      ]
    },

    {
      "name": "Veyrier-du-Lac Chavoires",
      "outbound": [
        [],
        [385, 475, 685, 760, 865, 1040, 1100, 1160],
        [385, 475, 685, 760, 865, 1040, 1100, 1160],
        [385, 475, 685, 760, 865, 1040, 1100, 1160],
        [385, 475, 685, 760, 865, 1040, 1100, 1160],
        [385, 475, 685, 760, 865, 1040, 1100, 1160],
        [385, 475,      760, 865,       1100,     ],
      ],
      "inbound": [
        [],
        [428, 513, 728, 813, 908, 1086, 1146, 1198],
        [428, 513, 728, 813, 908, 1086, 1146, 1198],
        [428, 513, 728, 813, 908, 1086, 1146, 1198],
        [428, 513, 728, 813, 908, 1086, 1146, 1198],
        [428, 513, 728, 813, 908, 1086, 1146, 1198],
        [428, 513,      813, 908,       1146,     ],
      ]
    },

    {
      "name": "Veyrier-du-Lac T&eacute;l&eacute;ph&eacute;rique",
      "outbound": [
        [],
        [386, 476, 686, 761, 866, 1041, 1101, 1161],
        [386, 476, 686, 761, 866, 1041, 1101, 1161],
        [386, 476, 686, 761, 866, 1041, 1101, 1161],
        [386, 476, 686, 761, 866, 1041, 1101, 1161],
        [386, 476, 686, 761, 866, 1041, 1101, 1161],
        [386, 476,      761, 866,       1101,     ],
      ],
      "inbound": [
        [],
        [427, 512, 727, 812, 907, 1085, 1145, 1197],
        [427, 512, 727, 812, 907, 1085, 1145, 1197],
        [427, 512, 727, 812, 907, 1085, 1145, 1197],
        [427, 512, 727, 812, 907, 1085, 1145, 1197],
        [427, 512, 727, 812, 907, 1085, 1145, 1197],
        [427, 512,      812, 907,       1145,     ],
      ]
    },

    {
      "name": "Veyrier-du-Lac Chef-Lieu",
      "outbound": [
        [],
        [390, 480, 690, 765, 870, 1045, 1105, 1165],
        [390, 480, 690, 765, 870, 1045, 1105, 1165],
        [390, 480, 690, 765, 870, 1045, 1105, 1165],
        [390, 480, 690, 765, 870, 1045, 1105, 1165],
        [390, 480, 690, 765, 870, 1045, 1105, 1165],
        [390, 480,      765, 870,       1105,     ],
      ],
      "inbound": [
        [],
        [425, 510, 725, 810, 905, 1083, 1143, 1195],
        [425, 510, 725, 810, 905, 1083, 1143, 1195],
        [425, 510, 725, 810, 905, 1083, 1143, 1195],
        [425, 510, 725, 810, 905, 1083, 1143, 1195],
        [425, 510, 725, 810, 905, 1083, 1143, 1195],
        [425, 510,      810, 905,       1143,     ],
      ]
    },

    {
      "name": "Menthon-St-Brenard Presles",
      "outbound": [
        [],
        [393, 483, 693, 768, 873, 1048, 1108, 1169],
        [393, 483, 693, 768, 873, 1048, 1108, 1169],
        [393, 483, 693, 768, 873, 1048, 1108, 1169],
        [393, 483, 693, 768, 873, 1048, 1108, 1169],
        [393, 483, 693, 768, 873, 1048, 1108, 1169],
        [393, 483,      768, 873,       1108,     ],
      ],
      "inbound": [
        [],
        [422, 507, 722, 807, 902, 1080, 1140, 1194],
        [422, 507, 722, 807, 902, 1080, 1140, 1194],
        [422, 507, 722, 807, 902, 1080, 1140, 1194],
        [422, 507, 722, 807, 902, 1080, 1140, 1194],
        [422, 507, 722, 807, 902, 1080, 1140, 1194],
        [422, 507,      807, 902,       1140,     ],
      ]
    },

    {
      "name": "Menthon Chef-Lieu",
      "outbound": [
        [],
        [395, 485, 695, 770, 875, 1050, 1110, 1170],
        [395, 485, 695, 770, 875, 1050, 1110, 1170],
        [395, 485, 695, 770, 875, 1050, 1110, 1170],
        [395, 485, 695, 770, 875, 1050, 1110, 1170],
        [395, 485, 695, 770, 875, 1050, 1110, 1170],
        [395, 485,      770, 875,       1110,     ],
      ],
      "inbound": [
        [],
        [420, 505, 720, 805, 900, 1078, 1138, 1192],
        [420, 505, 720, 805, 900, 1078, 1138, 1192],
        [420, 505, 720, 805, 900, 1078, 1138, 1192],
        [420, 505, 720, 805, 900, 1078, 1138, 1192],
        [420, 505, 720, 805, 900, 1078, 1138, 1192],
        [420, 505,      805, 900,       1138,     ],
      ]
    },

    {
      "name": "Talloires &Eacute;charvines",
      "outbound": [
        [],
        [398, 488, 698, 773, 878, 1053, 1113, 1173],
        [398, 488, 698, 773, 878, 1053, 1113, 1173],
        [398, 488, 698, 773, 878, 1053, 1113, 1173],
        [398, 488, 698, 773, 878, 1053, 1113, 1173],
        [398, 488, 698, 773, 878, 1053, 1113, 1173],
        [398, 488,      773, 878,       1113,     ],
      ],
      "inbound": [
        [],
        [417, 502, 718, 803, 898, 1074, 1134, 1190],
        [417, 502, 718, 803, 898, 1074, 1134, 1190],
        [417, 502, 718, 803, 898, 1074, 1134, 1190],
        [417, 502, 718, 803, 898, 1074, 1134, 1190],
        [417, 502, 718, 803, 898, 1074, 1134, 1190],
        [417, 502,      803, 898,       1134,     ],
      ]
    },

    {
      "name": "Talloires Les Granges",
      "outbound": [
        [],
        [399, 489, 699, 774, 879, 1054, 1114, 1174],
        [399, 489, 699, 774, 879, 1054, 1114, 1174],
        [399, 489, 699, 774, 879, 1054, 1114, 1174],
        [399, 489, 699, 774, 879, 1054, 1114, 1174],
        [399, 489, 699, 774, 879, 1054, 1114, 1174],
        [399, 489,      774, 879,       1114,     ],
      ],
      "inbound": [
        [],
        [416, 501, 717, 802, 897, 1073, 1133, 1189],
        [416, 501, 717, 802, 897, 1073, 1133, 1189],
        [416, 501, 717, 802, 897, 1073, 1133, 1189],
        [416, 501, 717, 802, 897, 1073, 1133, 1189],
        [416, 501, 717, 802, 897, 1073, 1133, 1189],
        [416, 501,      802, 897,       1133,     ],
      ]
    },

    {
      "name": "Talloires &Eacute;coles (Tufts)",
      "outbound": [
        [],
        [400, 490, 705, 780, 885, 1060, 1120, 1180],
        [400, 490, 705, 780, 885, 1060, 1120, 1180],
        [400, 490, 705, 780, 885, 1060, 1120, 1180],
        [400, 490, 705, 780, 885, 1060, 1120, 1180],
        [400, 490, 705, 780, 885, 1060, 1120, 1180],
        [400, 490,      780, 885,       1120,     ],
      ],
      "inbound": [
        [],
        [412, 497, 712, 797, 892, 1067, 1127, 1187],
        [412, 497, 712, 797, 892, 1067, 1127, 1187],
        [412, 497, 712, 797, 892, 1067, 1127, 1187],
        [412, 497, 712, 797, 892, 1067, 1127, 1187],
        [412, 497, 712, 797, 892, 1067, 1127, 1187],
        [412, 497,      797, 892,       1127,     ],
      ]
    },

    {
      "name": "Talloires Angon",
      "outbound": [
        [],
        [405, 495, 710, 785, 890, 1065, 1125, 1185],
        [405, 495, 710, 785, 890, 1065, 1125, 1185],
        [405, 495, 710, 785, 890, 1065, 1125, 1185],
        [405, 495, 710, 785, 890, 1065, 1125, 1185],
        [405, 495, 710, 785, 890, 1065, 1125, 1185],
        [405, 495,      785, 890,       1125,     ],
      ],
      "inbound": [
        [],
        [410, 495, 710, 795, 890, 1065, 1125, 1185],
        [410, 495, 710, 795, 890, 1065, 1125, 1185],
        [410, 495, 710, 795, 890, 1065, 1125, 1185],
        [410, 495, 710, 795, 890, 1065, 1125, 1185],
        [410, 495, 710, 795, 890, 1065, 1125, 1185],
        [410, 495,      795, 890,       1125,     ],
      ]
    }
  ]
};

function timeAfter(cur, times) {
  for (j in times) {
    if (times[j] >= cur)
      return times[j];
  }
  return -1;
}

function timeify(time) {
  var hr = Math.floor((time / 60) % 12);
  if (hr == 0)
    hr = 12;
  
  var mn = time % 60;
  if (mn < 10)
    mn = "0" + mn;

  return (hr + ":" + mn);
}

function update() {
  var l = document.getElementById("lower");
  l.innerHTML = "";

  var currentDate = new Date();
  var currentTime = currentDate.getHours() * 60 + currentDate.getMinutes();
  var currentDay = currentDate.getDay();

  var stopsList = [];

  for (i in data.stops) {
    var times;

    if (inbound)
      times = data.stops[i].inbound[currentDay];
    else
      times = data.stops[i].outbound[currentDay];

    var container = document.createElement('div');
    container.className = "con";

    var nextTime = document.createElement('div');
    nextTime.className = "nt";
    var ntVal = timeAfter(currentTime, times) - currentTime;
    if (ntVal >= 0)
      nextTime.innerText = timeAfter(currentTime, times) - currentTime;
    else
      nextTime.innerText = "--";

    if (ntVal > 90 || ntVal < 0) {
      container.style.color = "#633B6E";
    } else if (ntVal <= 10) {
      container.style.color = "#FF1F7A";
      // container.style.backgroundColor = "#3B071C";
    } else if (ntVal <= 20) {
      container.style.color = "#FF5C3B";
    } else if (ntVal <= 30) {
      container.style.color = "#FF962E";
    }

    var nextTimeMinLabel = document.createElement('div');
    nextTimeMinLabel.className = "ntmin";
    nextTimeMinLabel.innerText = "min.";

    var stopName = document.createElement('div');
    stopName.className = "nam";
    stopName.innerHTML = data.stops[i].name;

    var restOfTimes = document.createElement('div');
    restOfTimes.className = "rt";
    var numTimes = 0;
    restOfTimes.innerHTML += "&nbsp;";
    for (j in times) {
      if (times[j] >= currentTime && numTimes < 6) {
          restOfTimes.innerText += timeify(times[j]) + " ";
          numTimes++;
        }
    }

    nextTime.appendChild(nextTimeMinLabel);
    container.appendChild(nextTime);
    container.appendChild(stopName);
    container.appendChild(restOfTimes);
    // l.appendChild(container);
    if (inbound)
      stopsList.unshift(container);
    else
      stopsList.push(container);
  }

  for (i in stopsList) {
    l.appendChild(stopsList[i]);
  }

  if (shouldAnimate)
    animateIn();
  else
    appearIn();

  updateInterval = setInterval(update, 10000);
}

function animateIn() {
  var myEles = document.getElementById("lower").getElementsByClassName("con");
  for (var q=0; q<myEles.length; q++) {
        (function(q) {
            setTimeout(function() {             
                // alert(q);
                myEles[q].style.opacity = 1;
            }, q * 50);
        })(q);
    }
  shouldAnimate = false;
}

function appearIn() {
  var myEles = document.getElementById("lower").getElementsByClassName("con");
  for (var q=0; q<myEles.length; q++) {
    myEles[q].style.opacity = 1;
  }
}

		</script>
	</head>
	<body onload="update();">
    <div id="bound" onclick="changeDir();">Annecy > Talloires</div>
    <div id="lower"></div>
	</body>
</html>